openapi: 3.0.3
info:
  title: JARVIS Web Portal API
  version: 0.1.0
servers:
  - url: http://localhost
paths:
  /api/media:
    get:
      summary: List photos and videos combined
      parameters:
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: offset
          schema: { type: integer }
        - in: query
          name: type
          schema: 
            type: string
            enum: [photo, video]
      responses:
        '200': 
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean }
                  count: { type: integer }
                  media:
                    type: array
                    items:
                      type: object
                      properties:
                        type: { type: string, enum: [photo, video] }
                        id: { type: integer }
                        filename: { type: string }
                        url: { type: string }
                        thumb_url: { type: string }
                        created_at: { type: string }
  /api/photos:
    get:
      summary: List photos
      parameters:
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: offset
          schema: { type: integer }
      responses:
        '200': { description: OK }
    post:
      summary: Upload a photo (JWT or device token)
        '201': { description: Created }
        '413': { description: File too large }
        '415': { description: Unsupported file type }
        '429': { description: Rate limited }
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                meta:
                  type: string
      responses:
        '201': { description: Created }
  /api/photos/{id}/download:
    get:
      summary: Download photo
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: query
          name: thumb
          schema: { type: boolean }
      responses:
        '200': { description: OK }
  /api/photos/{id}/reprocess:
    post:
      summary: Reprocess photo; optionally override GPS (test)
      parameters:
        - in: path
          name: id          <?php
          jarvis_respond(201, ['ok' => true, 'event_id' => $eventId]);
          required: true
          schema: { type: integer }
      requestBody:
        '201': { description: Created }
        '429': { description: Rate limited }
  /api/devices:
    get:
      summary: List devices for user
      responses:
        '200': { description: OK }
    post:
      summary: Register a device
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid: { type: string }
                platform: { type: string }
                push_provider: { type: string }
                push_token: { type: string }
      responses:
        '200': { description: OK }
          application/json:
            schema:
              type: object
              properties:
                gps_lat: { type: number }
                gps_lon: { type: number }
      responses:
        '200': { description: OK }
  /api/device_tokens:
    get:
      summary: List device tokens
      responses:
        '200': { description: OK }
    post:
      summary: Create a device token
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                label: { type: string }
                ttl_seconds: { type: integer }
      responses:
        '200': { description: OK }
  /api/messages:
    get:
      summary: List local messages
      parameters:
        - in: query
          name: channel
          schema: { type: string }
        - in: query
          name: thread_id
          schema: { type: integer }
        - in: query
          name: tag
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: offset
          schema: { type: integer }
      responses:
        '200': { description: OK }
    post:
      summary: Post a message (local or Slack)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message: { type: string }
                channel: { type: string }
                provider: { type: string }
                thread_id: { type: integer }
      responses:
        '201': { description: Created }
  /api/messages/{id}:
    delete:
      summary: Delete local message
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
    patch:
      summary: Edit local message
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message: { type: string }
      responses:
        '200': { description: OK }
  /api/messages/{id}/reactions:
    get:
      summary: List reactions
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
    post:
      summary: Add a reaction
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type: { type: string }
      responses:
        '200': { description: OK }
    delete:
      summary: Remove a reaction
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type: { type: string }
      responses:
        '200': { description: OK }
